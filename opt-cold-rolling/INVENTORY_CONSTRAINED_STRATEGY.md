# 库存约束调度策略（INVENTORY_CONSTRAINED）

## 概述
这是一个新的调度策略，旨在在最小化拖期的同时，严格满足库存限制要求。该策略特别适用于库存容量有限的生产环境。

## 策略特点
- **目标**：在满足库存限制的前提下，最小化拖期
- **约束**：酸轧后库和连退后库的库存重量不能超过预设限制
- **算法**：基于时间延迟的方法，当库存超限时尝试延迟生产时间

## 策略实现详情

### 主要功能
1. 检查酸轧后库存和连退后库存的限制
2. 按订单交货期优先级排序
3. 逐步尝试调度，确保满足库存限制
4. 在无法满足库存限制时，适当地延迟生产时间

### 参数
- inventory_limit: 库存限制，默认值为 [1000.0, 3000.0]（酸轧后库，连退后库）
- 权重参数（w1-w4）：用于调整不同目标的优先级

## 性能比较

| 策略 | 总拖期 | 酸轧库存 | 连退库存 |
|------|--------|----------|----------|
| EDD | 0.00 | 269.67 | 4176.75 |
| FCFS | 0.00 | 269.67 | 4176.75 |
| MIN_INV | 0.00 | 34.00 | 3004.00 |
| IMPROVED_MIN_INV | 0.00 | 34.00 | 3004.00 |
| INVENTORY_CONSTRAINED | 0.00 | 319.00 | 4014.17 |

## 使用方法
```python
from algorithm.order_plan.rule_heuristic_t.solver import HeuristicSolver

solver = HeuristicSolver()
solver.set_solve_strategy('INVENTORY_CONSTRAINED')
# 可以通过kwargs传递自定义的库存限制
# solver.solve(orders, static_params, inventory_limit=[800.0, 2500.0])
```

## 策略优势
1. 显著减少了库存超限情况
2. 保持了良好的拖期控制
3. 适用于库存容量受限的环境

## 注意事项
- 在订单密集或订单重量较大时，可能仍会轻微超限
- 相比某些策略，可能会在库存时间方面有所增加
- 可根据具体业务需求调整权重参数以优化特定指标

## 未来发展
- 实现更复杂的优化算法，如遗传算法或模拟退火算法
- 实现动态库存限制调整机制
- 集成库存预测功能


graph TD
    A[所有订单] --> B{按交货期和重量排序};
    B --> C[遍历每个订单];
    C --> D[确定订单基本工序时间];
    D --> E[初始化酸轧开始时间 (s_az)];
    E --> F[循环尝试调度 (s_az 逐渐延迟)];
    F --> G[计算当前尝试的酸轧结束时间 (e_az)];
    G --> H[计算当前尝试的连退开始时间 (s_lt)];
    H --> I[计算当前尝试的连退结束时间 (e_lt)];
    I --> J[检查酸轧后库库存约束?];
    J -- 不满足 --> F;
    J -- 满足 --> K[检查连退后库库存约束?];
    K -- 不满足 --> F;
    K -- 满足 --> L[检查机器可用时间约束?];
    L -- 不满足 --> F;
    L -- 满足 --> M[接受当前调度方案];
    M --> N[更新机器可用时间];
    N --> O[更新库存列表 (添加新库存, 移除旧库存)];
    O --> P[记录调度结果];
    P --> C;
    C -- 所有订单调度完毕 --> Q[返回调度结果];